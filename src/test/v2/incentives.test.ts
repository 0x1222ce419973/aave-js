import { formatUserSummaryData } from '../../v2';

const snapshot = {
  rawReserves: [
    {
      __typename: 'ReserveData',
      aEmissionPerSecond: '198333333333333000',
      aIncentivesLastUpdateTimestamp: 1630506862,
      aTokenAddress: '0x8df3aad3a84da6b69a4da8aec3ea40d9091b2ac4',
      aTokenIncentivesIndex: '20660345475426972',
      availableLiquidity: '149333551218535235293539692',
      averageStableRate: '0',
      baseLTVasCollateral: '5000',
      baseVariableBorrowRate: '0',
      borrowingEnabled: true,
      decimals: 18,
      id:
        '0x0d500b1d8e8ef31e21c99d1db9a6444d3adf12700xd05e3e715d945b59290df0ae8ef85c1bdb684744',
      isActive: true,
      isFrozen: false,
      lastUpdateTimestamp: 1630506862,
      liquidityIndex: '1009353193643359644560918280',
      liquidityRate: '6143541768493785213142194',
      name: '',
      optimalUtilisationRate: '',
      price: { __typename: 'PriceData', priceInEth: '401234742075472' },
      reserveFactor: '2000',
      reserveLiquidationBonus: '11000',
      reserveLiquidationThreshold: '6500',
      sEmissionPerSecond: '0',
      sIncentivesLastUpdateTimestamp: 0,
      sTokenIncentivesIndex: '0',
      stableBorrowRate: '99375230634357005635648217',
      stableBorrowRateEnabled: false,
      stableDebtLastUpdateTimestamp: 0,
      stableDebtTokenAddress: '0xb9a6e29fb540c5f1243ef643eb39b0acbc2e68e3',
      stableRateSlope1: '100000000000000000000000000',
      stableRateSlope2: '3000000000000000000000000000',
      symbol: 'MATIC',
      totalPrincipalStableDebt: '0',
      totalScaledVariableDebt: '41485777313062665269956917',
      underlyingAsset: '0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee',
      usageAsCollateralEnabled: true,
      vEmissionPerSecond: '22037037037037000',
      vIncentivesLastUpdateTimestamp: 1630506790,
      vTokenIncentivesIndex: '33925233468577792',
      variableBorrowIndex: '1028265993882519993325674897',
      variableBorrowRate: '34562661444049903944953751',
      variableDebtTokenAddress: '0x59e8e9100cbfcbcbadf86b9279fa61526bbb8765',
      variableRateSlope1: '70000000000000000000000000',
      variableRateSlope2: '3000000000000000000000000000',
    },
    {
      __typename: 'ReserveData',
      aEmissionPerSecond: '363611111111111000',
      aIncentivesLastUpdateTimestamp: 1630506858,
      aTokenAddress: '0x27f8d03b3a2196956ed754badc28d73be8830a6e',
      aTokenIncentivesIndex: '17947572063705804',
      availableLiquidity: '178725334153698415583670811',
      averageStableRate: '0',
      baseLTVasCollateral: '7500',
      baseVariableBorrowRate: '0',
      borrowingEnabled: true,
      decimals: 18,
      id:
        '0x8f3cf7ad23cd3cadbd9735aff958023239c6a0630xd05e3e715d945b59290df0ae8ef85c1bdb684744',
      isActive: true,
      isFrozen: false,
      lastUpdateTimestamp: 1630506818,
      liquidityIndex: '1017555569457514315144085375',
      liquidityRate: '28600919182420677969426545',
      name: '',
      optimalUtilisationRate: '',
      price: { __typename: 'PriceData', priceInEth: '283890756834397' },
      reserveFactor: '1000',
      reserveLiquidationBonus: '10500',
      reserveLiquidationThreshold: '8000',
      sEmissionPerSecond: '0',
      sIncentivesLastUpdateTimestamp: 0,
      sTokenIncentivesIndex: '0',
      stableBorrowRate: '58930754843826955227592674',
      stableBorrowRateEnabled: false,
      stableDebtLastUpdateTimestamp: 0,
      stableDebtTokenAddress: '0x2238101b7014c279aaf6b408a284e49cdbd5db55',
      stableRateSlope1: '20000000000000000000000000',
      stableRateSlope2: '750000000000000000000000000',
      symbol: 'DAI',
      totalPrincipalStableDebt: '0',
      totalScaledVariableDebt: '686067113999943022149593941',
      underlyingAsset: '0x8f3cf7ad23cd3cadbd9735aff958023239c6a063',
      usageAsCollateralEnabled: true,
      vEmissionPerSecond: '545416666666667000',
      vIncentivesLastUpdateTimestamp: 1630506818,
      vTokenIncentivesIndex: '24663168101383367',
      variableBorrowIndex: '1024235838023885332485814694',
      variableBorrowRate: '39861509687653910455185348',
      variableDebtTokenAddress: '0x75c4d1fb84429023170086f06e682dcbbf537b7d',
      variableRateSlope1: '40000000000000000000000000',
      variableRateSlope2: '750000000000000000000000000',
    },
    {
      __typename: 'ReserveData',
      aEmissionPerSecond: '330555555555556000',
      aIncentivesLastUpdateTimestamp: 1630506860,
      aTokenAddress: '0x1a13f4ca1d028320a707d99520abfefca3998b7f',
      aTokenIncentivesIndex: '13188129730237729547844225256',
      availableLiquidity: '122569177686892',
      averageStableRate: '0',
      baseLTVasCollateral: '8000',
      baseVariableBorrowRate: '0',
      borrowingEnabled: true,
      decimals: 6,
      id:
        '0x2791bca1f2de4661ed88a30c99a7a9449aa841740xd05e3e715d945b59290df0ae8ef85c1bdb684744',
      isActive: true,
      isFrozen: false,
      lastUpdateTimestamp: 1630506860,
      liquidityIndex: '1012616441065467509961035555',
      liquidityRate: '31666904044272189713792526',
      name: '',
      optimalUtilisationRate: '',
      price: { __typename: 'PriceData', priceInEth: '283781830000000' },
      reserveFactor: '1000',
      reserveLiquidationBonus: '10500',
      reserveLiquidationThreshold: '8500',
      sEmissionPerSecond: '0',
      sIncentivesLastUpdateTimestamp: 0,
      sTokenIncentivesIndex: '0',
      stableBorrowRate: '58772441241418209749523786',
      stableBorrowRateEnabled: false,
      stableDebtLastUpdateTimestamp: 0,
      stableDebtTokenAddress: '0xdeb05676db0db85cecafe8933c903466bf20c572',
      stableRateSlope1: '20000000000000000000000000',
      stableRateSlope2: '600000000000000000000000000',
      symbol: 'USDC',
      totalPrincipalStableDebt: '0',
      totalScaledVariableDebt: '972639682061108',
      underlyingAsset: '0x2791bca1f2de4661ed88a30c99a7a9449aa84174',
      usageAsCollateralEnabled: true,
      vEmissionPerSecond: '495833333333333000',
      vIncentivesLastUpdateTimestamp: 1630506860,
      vTokenIncentivesIndex: '17892105159198284475919163899',
      variableBorrowIndex: '1017096882939962878855005371',
      variableBorrowRate: '39544882482836419499047571',
      variableDebtTokenAddress: '0x248960a9d75edfa3de94f7193eae3161eb349a12',
      variableRateSlope1: '40000000000000000000000000',
      variableRateSlope2: '600000000000000000000000000',
    },
    {
      __typename: 'ReserveData',
      aEmissionPerSecond: '132222222222222000',
      aIncentivesLastUpdateTimestamp: 1630506858,
      aTokenAddress: '0x60d55f02a771d515e077c9c2403a1ef324885cec',
      aTokenIncentivesIndex: '35718812309378950564525032817',
      availableLiquidity: '17843994455433',
      averageStableRate: '0',
      baseLTVasCollateral: '0',
      baseVariableBorrowRate: '0',
      borrowingEnabled: true,
      decimals: 6,
      id:
        '0xc2132d05d31c914a87c6611c10748aeb04b58e8f0xd05e3e715d945b59290df0ae8ef85c1bdb684744',
      isActive: true,
      isFrozen: false,
      lastUpdateTimestamp: 1630506852,
      liquidityIndex: '1026512032707197938113056619',
      liquidityRate: '48781054657418212422752943',
      name: '',
      optimalUtilisationRate: '',
      price: { __typename: 'PriceData', priceInEth: '282524925007142' },
      reserveFactor: '1000',
      reserveLiquidationBonus: '0',
      reserveLiquidationThreshold: '0',
      sEmissionPerSecond: '0',
      sIncentivesLastUpdateTimestamp: 0,
      sTokenIncentivesIndex: '0',
      stableBorrowRate: '75001283037921270652844908',
      stableBorrowRateEnabled: false,
      stableDebtLastUpdateTimestamp: 0,
      stableDebtTokenAddress: '0xe590cfca10e81fed9b0e4496381f02256f5d2f61',
      stableRateSlope1: '20000000000000000000000000',
      stableRateSlope2: '600000000000000000000000000',
      symbol: 'USDT',
      totalPrincipalStableDebt: '0',
      totalScaledVariableDebt: '161534893217713',
      underlyingAsset: '0xc2132d05d31c914a87c6611c10748aeb04b58e8f',
      usageAsCollateralEnabled: false,
      vEmissionPerSecond: '198333333333333000',
      vIncentivesLastUpdateTimestamp: 1630506832,
      vTokenIncentivesIndex: '42882921617259993703259869848',
      variableBorrowIndex: '1032281364472958712467481600',
      variableBorrowRate: '60001283037921270652844908',
      variableDebtTokenAddress: '0x8038857fd47108a07d1f6bf652ef1cbec279a2f3',
      variableRateSlope1: '40000000000000000000000000',
      variableRateSlope2: '600000000000000000000000000',
    },
    {
      __typename: 'ReserveData',
      aEmissionPerSecond: '371875000000000000',
      aIncentivesLastUpdateTimestamp: 1630506860,
      aTokenAddress: '0x28424507fefb6f7f8e9d3860f56504e4e5f5f390',
      aTokenIncentivesIndex: '22541853432544540475',
      availableLiquidity: '317154547687847172247296',
      averageStableRate: '0',
      baseLTVasCollateral: '8000',
      baseVariableBorrowRate: '0',
      borrowingEnabled: true,
      decimals: 18,
      id:
        '0x7ceb23fd6bc0add59e62ac25578270cff1b9f6190xd05e3e715d945b59290df0ae8ef85c1bdb684744',
      isActive: true,
      isFrozen: false,
      lastUpdateTimestamp: 1630506846,
      liquidityIndex: '1003203479999792158635332447',
      liquidityRate: '1735388892685028548465704',
      name: '',
      optimalUtilisationRate: '',
      price: { __typename: 'PriceData', priceInEth: '1000000000000000000' },
      reserveFactor: '1000',
      reserveLiquidationBonus: '10500',
      reserveLiquidationThreshold: '8250',
      sEmissionPerSecond: '0',
      sIncentivesLastUpdateTimestamp: 0,
      sTokenIncentivesIndex: '0',
      stableBorrowRate: '49256416916292239676580261',
      stableBorrowRateEnabled: false,
      stableDebtLastUpdateTimestamp: 0,
      stableDebtTokenAddress: '0xc478cbbeb590c76b01ce658f8c4dda04f30e2c6f',
      stableRateSlope1: '100000000000000000000000000',
      stableRateSlope2: '1000000000000000000000000000',
      symbol: 'WETH',
      totalPrincipalStableDebt: '0',
      totalScaledVariableDebt: '44884480779096017114186',
      underlyingAsset: '0x7ceb23fd6bc0add59e62ac25578270cff1b9f619',
      usageAsCollateralEnabled: true,
      vEmissionPerSecond: '41319444444444400',
      vIncentivesLastUpdateTimestamp: 1630506790,
      vTokenIncentivesIndex: '50056630315301000565',
      variableBorrowIndex: '1010970011841420557157351587',
      variableBorrowRate: '15405133533033791741264209',
      variableDebtTokenAddress: '0xede17e9d79fc6f9ff9250d9eefbdb88cc18038b5',
      variableRateSlope1: '80000000000000000000000000',
      variableRateSlope2: '1000000000000000000000000000',
    },
    {
      __typename: 'ReserveData',
      aEmissionPerSecond: '37187500000000000',
      aIncentivesLastUpdateTimestamp: 1630506862,
      aTokenAddress: '0x5c2ed810328349100a66b82b78a1791b101c9d61',
      aTokenIncentivesIndex: '5715987416624733509299322420917',
      availableLiquidity: '843302578429',
      averageStableRate: '0',
      baseLTVasCollateral: '7000',
      baseVariableBorrowRate: '0',
      borrowingEnabled: true,
      decimals: 8,
      id:
        '0x1bfd67037b42cf73acf2047067bd4f2c47d9bfd60xd05e3e715d945b59290df0ae8ef85c1bdb684744',
      isActive: true,
      isFrozen: false,
      lastUpdateTimestamp: 1630506844,
      liquidityIndex: '1003574185847105766237172674',
      liquidityRate: '59487538498189929474727',
      name: '',
      optimalUtilisationRate: '',
      price: { __typename: 'PriceData', priceInEth: '13460000000000000000' },
      reserveFactor: '2000',
      reserveLiquidationBonus: '11000',
      reserveLiquidationThreshold: '7500',
      sEmissionPerSecond: '0',
      sIncentivesLastUpdateTimestamp: 0,
      sTokenIncentivesIndex: '0',
      stableBorrowRate: '33781519411832350621552224',
      stableBorrowRateEnabled: false,
      stableDebtLastUpdateTimestamp: 0,
      stableDebtTokenAddress: '0x2551b15db740db8348bfadfe06830210ec2c2f13',
      stableRateSlope1: '100000000000000000000000000',
      stableRateSlope2: '3000000000000000000000000000',
      symbol: 'WBTC',
      totalPrincipalStableDebt: '0',
      totalScaledVariableDebt: '21018268998',
      underlyingAsset: '0x1bfd67037b42cf73acf2047067bd4f2c47d9bfd6',
      usageAsCollateralEnabled: true,
      vEmissionPerSecond: '4131944444444440',
      vIncentivesLastUpdateTimestamp: 1630506790,
      vTokenIncentivesIndex: '13077638834848566974961453824215',
      variableBorrowIndex: '1011054256170691081353422569',
      variableBorrowRate: '3025215529465880497241778',
      variableDebtTokenAddress: '0xf664f50631a6f0d72ecdaa0e49b0c019fa72a8dc',
      variableRateSlope1: '80000000000000000000000000',
      variableRateSlope2: '3000000000000000000000000000',
    },
    {
      __typename: 'ReserveData',
      aEmissionPerSecond: '13773148148148100',
      aIncentivesLastUpdateTimestamp: 1630506790,
      aTokenAddress: '0x1d2a0e5ec8e5bbdca5cb219e649b565d8e5c3360',
      aTokenIncentivesIndex: '14722993869757447952',
      availableLiquidity: '189436994702665466135808',
      averageStableRate: '0',
      baseLTVasCollateral: '5000',
      baseVariableBorrowRate: '0',
      borrowingEnabled: false,
      decimals: 18,
      id:
        '0xd6df932a45c0f255f85145f286ea0b292b21c90b0xd05e3e715d945b59290df0ae8ef85c1bdb684744',
      isActive: true,
      isFrozen: false,
      lastUpdateTimestamp: 1630506658,
      liquidityIndex: '1000016896937665042044430729',
      liquidityRate: '0',
      name: '',
      optimalUtilisationRate: '',
      price: { __typename: 'PriceData', priceInEth: '111852840000000000' },
      reserveFactor: '0',
      reserveLiquidationBonus: '11000',
      reserveLiquidationThreshold: '6500',
      sEmissionPerSecond: '0',
      sIncentivesLastUpdateTimestamp: 0,
      sTokenIncentivesIndex: '0',
      stableBorrowRate: '30000000000000000000000000',
      stableBorrowRateEnabled: false,
      stableDebtLastUpdateTimestamp: 0,
      stableDebtTokenAddress: '0x17912140e780b29ba01381f088f21e8d75f954f9',
      stableRateSlope1: '0',
      stableRateSlope2: '0',
      symbol: 'AAVE',
      totalPrincipalStableDebt: '0',
      totalScaledVariableDebt: '0',
      underlyingAsset: '0xd6df932a45c0f255f85145f286ea0b292b21c90b',
      usageAsCollateralEnabled: true,
      vEmissionPerSecond: '0',
      vIncentivesLastUpdateTimestamp: 1630506790,
      vTokenIncentivesIndex: '0',
      variableBorrowIndex: '1000000000000000000000000000',
      variableBorrowRate: '0',
      variableDebtTokenAddress: '0x1c313e9d0d826662f5ce692134d938656f681350',
      variableRateSlope1: '0',
      variableRateSlope2: '0',
    },
  ],
  rawUserReserves: [
    {
      __typename: 'UserReserveData',
      aTokenincentivesUserIndex: '13187928046464889180139879796',
      principalStableDebt: '0',
      sTokenincentivesUserIndex: '0',
      scaledATokenBalance: '20000320635',
      scaledVariableDebt: '0',
      stableBorrowLastUpdateTimestamp: 0,
      stableBorrowRate: '0',
      underlyingAsset: '0x2791bca1f2de4661ed88a30c99a7a9449aa84174',
      usageAsCollateralEnabledOnUser: true,
      vTokenincentivesUserIndex: '0',
      variableBorrowIndex: '0',
      reserve: {
        id:
          '0x2791bca1f2de4661ed88a30c99a7a9449aa841740xd05e3e715d945b59290df0ae8ef85c1bdb684744',
        underlyingAsset: '0x2791bca1f2de4661ed88a30c99a7a9449aa84174',
        name: '',
        symbol: 'USDC',
        decimals: 6,
        liquidityRate: '31666904044272189713792526',
        reserveLiquidationBonus: '10500',
        lastUpdateTimestamp: 1630506860,
      },
    },
    {
      __typename: 'UserReserveData',
      aTokenincentivesUserIndex: '35718321133616452485797384431',
      principalStableDebt: '0',
      sTokenincentivesUserIndex: '0',
      scaledATokenBalance: '7537384649',
      scaledVariableDebt: '0',
      stableBorrowLastUpdateTimestamp: 0,
      stableBorrowRate: '0',
      underlyingAsset: '0xc2132d05d31c914a87c6611c10748aeb04b58e8f',
      usageAsCollateralEnabledOnUser: true,
      vTokenincentivesUserIndex: '0',
      variableBorrowIndex: '0',
      reserve: {
        id:
          '0xc2132d05d31c914a87c6611c10748aeb04b58e8f0xd05e3e715d945b59290df0ae8ef85c1bdb684744',
        underlyingAsset: '0xc2132d05d31c914a87c6611c10748aeb04b58e8f',
        name: '',
        symbol: 'USDT',
        decimals: 6,
        liquidityRate: '48781054657418212422752943',
        reserveLiquidationBonus: '0',
        lastUpdateTimestamp: 1630506852,
      },
    },
    {
      __typename: 'UserReserveData',
      aTokenincentivesUserIndex: '5715958409005755164629048820165',
      principalStableDebt: '0',
      sTokenincentivesUserIndex: '0',
      scaledATokenBalance: '16492',
      scaledVariableDebt: '0',
      stableBorrowLastUpdateTimestamp: 0,
      stableBorrowRate: '0',
      underlyingAsset: '0x1bfd67037b42cf73acf2047067bd4f2c47d9bfd6',
      usageAsCollateralEnabledOnUser: true,
      vTokenincentivesUserIndex: '0',
      variableBorrowIndex: '0',
      reserve: {
        id:
          '0x1bfd67037b42cf73acf2047067bd4f2c47d9bfd60xd05e3e715d945b59290df0ae8ef85c1bdb684744',
        underlyingAsset: '0x1bfd67037b42cf73acf2047067bd4f2c47d9bfd6',
        name: '',
        symbol: 'WBTC',
        decimals: 8,
        liquidityRate: '59487538498189929474727',
        reserveLiquidationBonus: '11000',
        lastUpdateTimestamp: 1630506844,
      },
    },
    {
      __typename: 'UserReserveData',
      aTokenincentivesUserIndex: '22541163821314001576',
      principalStableDebt: '0',
      sTokenincentivesUserIndex: '0',
      scaledATokenBalance: '36606230589417941990',
      scaledVariableDebt: '0',
      stableBorrowLastUpdateTimestamp: 0,
      stableBorrowRate: '0',
      underlyingAsset: '0x7ceb23fd6bc0add59e62ac25578270cff1b9f619',
      usageAsCollateralEnabledOnUser: true,
      vTokenincentivesUserIndex: '0',
      variableBorrowIndex: '0',
      reserve: {
        id:
          '0x7ceb23fd6bc0add59e62ac25578270cff1b9f6190xd05e3e715d945b59290df0ae8ef85c1bdb684744',
        underlyingAsset: '0x7ceb23fd6bc0add59e62ac25578270cff1b9f619',
        name: '',
        symbol: 'WETH',
        decimals: 18,
        liquidityRate: '1735388892685028548465704',
        reserveLiquidationBonus: '10500',
        lastUpdateTimestamp: 1630506846,
      },
    },
    {
      __typename: 'UserReserveData',
      aTokenincentivesUserIndex: '20659644709698991',
      principalStableDebt: '0',
      sTokenincentivesUserIndex: '0',
      scaledATokenBalance: '180803085734270704200478',
      scaledVariableDebt: '0',
      stableBorrowLastUpdateTimestamp: 0,
      stableBorrowRate: '0',
      underlyingAsset: '0x0d500b1d8e8ef31e21c99d1db9a6444d3adf1270',
      usageAsCollateralEnabledOnUser: true,
      vTokenincentivesUserIndex: '0',
      variableBorrowIndex: '0',
      reserve: {
        id:
          '0x0d500b1d8e8ef31e21c99d1db9a6444d3adf12700xd05e3e715d945b59290df0ae8ef85c1bdb684744',
        underlyingAsset: '0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee',
        name: '',
        symbol: 'MATIC',
        decimals: 18,
        liquidityRate: '6143541768493785213142194',
        reserveLiquidationBonus: '11000',
        lastUpdateTimestamp: 1630506862,
      },
    },
    {
      __typename: 'UserReserveData',
      aTokenincentivesUserIndex: '14722950245592655759',
      principalStableDebt: '0',
      sTokenincentivesUserIndex: '0',
      scaledATokenBalance: '14043301737679620642',
      scaledVariableDebt: '0',
      stableBorrowLastUpdateTimestamp: 0,
      stableBorrowRate: '0',
      underlyingAsset: '0xd6df932a45c0f255f85145f286ea0b292b21c90b',
      usageAsCollateralEnabledOnUser: true,
      vTokenincentivesUserIndex: '0',
      variableBorrowIndex: '0',
      reserve: {
        id:
          '0xd6df932a45c0f255f85145f286ea0b292b21c90b0xd05e3e715d945b59290df0ae8ef85c1bdb684744',
        underlyingAsset: '0xd6df932a45c0f255f85145f286ea0b292b21c90b',
        name: '',
        symbol: 'AAVE',
        decimals: 18,
        liquidityRate: '0',
        reserveLiquidationBonus: '11000',
        lastUpdateTimestamp: 1630506658,
      },
    },
  ],
  userId: '0x01',
  usdPriceEth: '281011754721700',
  currentTimestamp: 1630506876,
  rewardInfo: {
    rewardTokenAddress: '0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE',
    rewardTokenDecimals: 18,
    incentivePrecision: 18,
    rewardTokenPriceEth: '401234742075472',
    emissionEndTimestamp: 1649851200,
  },
};

describe('incentives', () => {
  test('should return proper result', () => {
    const user = formatUserSummaryData(
      snapshot.rawReserves,
      snapshot.rawUserReserves,
      snapshot.userId,
      snapshot.usdPriceEth,
      snapshot.currentTimestamp,
      snapshot.rewardInfo
    );

    expect(user.totalRewards).toBe('0.161708680804975921');
  });
});
